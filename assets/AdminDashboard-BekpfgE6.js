import{r,j as e,R as is,u as cs}from"./index-DCLpxsI4.js";import{c as R,f as os,g as Ke,h as Ue,u as Je,B as v,C as b,a as y,i as Xe,j as Ye,A as Ze,k as ye,l as ds,r as Be,s as xs,d as Ge,m as ms}from"./useApparatusStatus-BDpyqEpX.js";import{T as U,b as V,g as z,X as We,a as ue,C as hs,M as gs}from"./github-D2nN5Jpt.js";const ps=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],us=R("activity",ps);const bs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ys=R("arrow-left",bs);const js=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Y=R("brain",js);const fs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Q=R("circle-alert",fs);const Ns=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],be=R("circle-x",Ns);const vs=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ws=R("clipboard-list",vs);const ks=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],je=R("clock",ks);const Cs=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]],Ss=R("house",Cs);const Is=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],As=R("image",Is);const Ls=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],fe=R("lightbulb",Ls);const $s=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],_s=R("lock",$s);const Ms=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],Ie=R("mail",Ms);const Rs=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],Ts=R("menu",Rs);const Es=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],B=R("package",Es);const Ds=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],te=R("refresh-cw",Ds);const Fs=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],qs=R("search",Fs);const Ps=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],Qe=R("sparkles",Ps);const zs=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Ne=R("trending-up",zs);const Vs=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],se=R("truck",Vs);const Os=[["path",{d:"M18 21V10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1v11",key:"pb2vm6"}],["path",{d:"M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 1.132-1.803l7.95-3.974a2 2 0 0 1 1.837 0l7.948 3.974A2 2 0 0 1 22 8z",key:"doq5xv"}],["path",{d:"M6 13h12",key:"yf64js"}],["path",{d:"M6 17h12",key:"1jwigz"}]],Hs=R("warehouse",Os);function Ae(){const[x,m]=r.useState([]),[c,h]=r.useState(!1),[g,k]=r.useState(null),[n,o]=r.useState(null),d=r.useCallback(async()=>{h(!0),k(null);try{const i=await os();m(i.items),o(i.fetchedAt)}catch(i){const C=i instanceof Error?i.message:"Failed to load inventory";k(C),console.error("Error loading inventory:",i)}finally{h(!1)}},[]);return r.useEffect(()=>{d()},[d]),{items:x,isLoading:c,error:g,lastFetchedAt:n,refresh:d}}function ve(x="pending"){const[m,c]=r.useState([]),[h,g]=r.useState(!1),[k,n]=r.useState(null),[o,d]=r.useState(0),i=r.useCallback(async()=>{g(!0),n(null);try{const a=await Ke(x);c(a.tasks),d(a.count)}catch(a){const j=a instanceof Error?a.message:"Failed to load tasks";n(j),console.error("Error loading tasks:",a)}finally{g(!1)}},[x]),C=r.useCallback(async(a,j,l,p)=>{try{await Ue(a,{status:"completed",chosenReplacement:j,completedBy:l,notes:p}),await i()}catch(A){throw A}},[i]),I=r.useCallback(async(a,j)=>{try{await Ue(a,{status:"canceled",notes:j}),await i()}catch(l){throw l}},[i]);return r.useEffect(()=>{i()},[i]),{tasks:m,isLoading:h,error:k,count:o,refresh:i,completeTask:C,cancelTask:I}}const Us=({adminPassword:x})=>{const[m,c]=r.useState(!0),[h,g]=r.useState(!1),[k,n]=r.useState(null),[o,d]=r.useState([]),[i,C]=r.useState(0),[I,a]=r.useState([]),[j,l]=r.useState(null),[p,A]=r.useState(null),{items:f,isLoading:w}=Ae(),{tasks:$,isLoading:F}=ve("pending"),{allVehicles:L,loading:O}=Je(),[T,K]=r.useState({totalDefects:0,criticalIssues:0,pendingTasks:0,outOfServiceVehicles:0,lowStockItems:0,todaySubmissions:0}),t=async(N=!0)=>{N?c(!0):g(!0);try{await M(),await Z(),ee(),n(new Date)}catch(_){console.error("Error loading dashboard data:",_)}finally{c(!1),g(!1)}},M=async()=>{try{const N=await z.getAllDefects();a(N);const _=[],q=N.filter(P=>P.status==="missing");q.length>0&&_.push({text:`${q.length} critical item${q.length!==1?"s":""} missing across the fleet - immediate action required`,type:"critical"});const D=N.filter(P=>P.status==="damaged");D.length>0&&_.push({text:`${D.length} damaged item${D.length!==1?"s":""} requiring repair or replacement`,type:"warning"});const G=new Map;N.forEach(P=>{G.set(P.apparatus,(G.get(P.apparatus)||0)+1)});const ne=Array.from(G.entries()).filter(([P,E])=>E>=3).sort((P,E)=>E[1]-P[1]);if(ne.length>0){const[P,E]=ne[0];_.push({text:`${P} has ${E} open issues - prioritize for comprehensive inspection`,type:"warning"})}const oe=G.size,re=Math.max(0,100-oe*7-N.length*2);C(re),re>=90&&_.push({text:`Fleet operating at optimal condition with ${re}% health score`,type:"positive"}),d(_)}catch(N){console.error("Error loading fleet data:",N)}},Z=async()=>{try{const N=await Ye();if(N.insights&&N.insights.length>0){const _=N.insights[0];l(_);try{const q=JSON.parse(_.insight_json);A(q)}catch(q){console.error("Failed to parse inventory insights:",q)}}}catch(N){console.error("Error loading inventory insights:",N)}},ae=async()=>{g(!0);try{await Xe({tasks:$,inventory:f}),await t(!1)}catch(N){console.error("Error re-analyzing:",N),alert("Failed to re-analyze data. Please try again.")}finally{g(!1)}},ee=()=>{const N=I.filter(D=>D.status==="missing").length,_=L.filter(D=>D.status.toLowerCase().includes("out of service")).length,q=new Set($.filter(D=>D.deficiencyType==="missing").map(D=>D.itemName)).size;K({totalDefects:I.length,criticalIssues:N,pendingTasks:$.length,outOfServiceVehicles:_,lowStockItems:q,todaySubmissions:0})};return r.useEffect(()=>{x&&!w&&!F&&!O&&t()},[x,w,F,O]),r.useEffect(()=>{!m&&I.length>=0&&ee()},[I,$,L]),m?e.jsxs("div",{className:"py-12 text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4 animate-pulse",children:e.jsx(Y,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Loading Dashboard"}),e.jsx("p",{className:"text-gray-600",children:"Gathering fleet data and AI insights..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl lg:text-3xl font-bold text-gray-900 flex items-center gap-3",children:[e.jsx(Y,{className:"w-7 h-7 lg:w-8 lg:h-8 text-blue-600"}),"AI-Powered Fleet Overview"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Real-time insights powered by AI â€¢ ",k?`Updated ${k.toLocaleTimeString()}`:"Loading..."]})]}),e.jsxs(v,{onClick:ae,disabled:h,variant:"secondary",className:"flex items-center gap-2 whitespace-nowrap",children:[e.jsx(te,{className:`w-4 h-4 ${h?"animate-spin":""}`}),h?"Re-Analyzing...":"Re-Analyze"]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3 sm:gap-4",children:[e.jsx(b,{className:"border-blue-300 bg-gradient-to-br from-blue-50 to-blue-100",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ne,{className:"w-5 h-5 text-blue-600"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:[i,"%"]})]}),e.jsx("p",{className:"text-xs font-semibold text-blue-900",children:"Fleet Health"})]})}),e.jsx(b,{className:`border-${T.criticalIssues>0?"red":"green"}-300 bg-gradient-to-br from-${T.criticalIssues>0?"red":"green"}-50 to-${T.criticalIssues>0?"red":"green"}-100`,children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(U,{className:`w-5 h-5 text-${T.criticalIssues>0?"red":"green"}-600`}),e.jsx("span",{className:`text-2xl font-bold text-${T.criticalIssues>0?"red":"green"}-600`,children:T.criticalIssues})]}),e.jsx("p",{className:`text-xs font-semibold text-${T.criticalIssues>0?"red":"green"}-900`,children:"Critical Issues"})]})}),e.jsx(b,{className:"border-orange-300 bg-gradient-to-br from-orange-50 to-orange-100",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Q,{className:"w-5 h-5 text-orange-600"}),e.jsx("span",{className:"text-2xl font-bold text-orange-600",children:T.totalDefects})]}),e.jsx("p",{className:"text-xs font-semibold text-orange-900",children:"Total Issues"})]})}),e.jsx(b,{className:"border-purple-300 bg-gradient-to-br from-purple-50 to-purple-100",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(us,{className:"w-5 h-5 text-purple-600"}),e.jsx("span",{className:"text-2xl font-bold text-purple-600",children:T.pendingTasks})]}),e.jsx("p",{className:"text-xs font-semibold text-purple-900",children:"Pending Tasks"})]})}),e.jsx(b,{className:"border-yellow-300 bg-gradient-to-br from-yellow-50 to-yellow-100",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(B,{className:"w-5 h-5 text-yellow-600"}),e.jsx("span",{className:"text-2xl font-bold text-yellow-600",children:T.lowStockItems})]}),e.jsx("p",{className:"text-xs font-semibold text-yellow-900",children:"Low Stock Items"})]})}),e.jsx(b,{className:"border-gray-300 bg-gradient-to-br from-gray-50 to-gray-100",children:e.jsxs(y,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(se,{className:"w-5 h-5 text-gray-600"}),e.jsx("span",{className:"text-2xl font-bold text-gray-600",children:T.outOfServiceVehicles})]}),e.jsx("p",{className:"text-xs font-semibold text-gray-900",children:"Out of Service"})]})})]}),o.length>0&&e.jsx(b,{className:"border-blue-300",children:e.jsxs(y,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Y,{className:"w-6 h-6 text-blue-600"}),"AI Fleet Insights - Priority Alerts"]}),e.jsx("div",{className:"space-y-3",children:o.map((N,_)=>{const D={critical:{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",icon:"text-red-600"},warning:{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",icon:"text-yellow-600"},positive:{bg:"bg-green-50",border:"border-green-200",text:"text-green-800",icon:"text-green-600"},info:{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-800",icon:"text-blue-600"}}[N.type],G=N.type==="critical"||N.type==="warning"?U:N.type==="positive"?V:Ne;return e.jsxs("div",{className:`flex items-start gap-3 p-4 ${D.bg} rounded-lg border ${D.border}`,children:[e.jsx(G,{className:`w-5 h-5 ${D.icon} flex-shrink-0 mt-0.5`}),e.jsx("p",{className:`text-sm font-medium ${D.text} flex-1`,children:N.text})]},_)})})]})}),p&&e.jsx(b,{className:"border-green-300",children:e.jsxs(y,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"w-6 h-6 text-green-600"}),"Inventory Intelligence"]}),e.jsxs("div",{className:"space-y-4",children:[p.summary&&e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded",children:e.jsx("p",{className:"text-sm font-medium text-blue-900",children:p.summary})}),p.reorderSuggestions&&p.reorderSuggestions.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(fe,{className:"w-5 h-5 text-green-600"}),"Recommended Actions"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:p.reorderSuggestions.slice(0,4).map((N,_)=>e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-green-900 text-sm truncate",children:N.item}),e.jsx("p",{className:"text-green-700 text-xs mt-1",children:N.reason})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold whitespace-nowrap ${N.urgency?.toLowerCase()==="high"?"bg-red-100 text-red-800":N.urgency?.toLowerCase()==="medium"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:N.urgency||"Low"})]})},_))})]}),p.recurringIssues&&p.recurringIssues.length>0&&e.jsxs("div",{className:"bg-orange-50 border-l-4 border-orange-500 p-4 rounded",children:[e.jsx("h4",{className:"font-semibold text-orange-900 mb-2",children:"âš ï¸ Recurring Issues"}),e.jsx("ul",{className:"space-y-1",children:p.recurringIssues.slice(0,3).map((N,_)=>e.jsxs("li",{className:"text-sm text-orange-800",children:["â€¢ ",N]},_))})]})]}),j&&e.jsxs("p",{className:"text-xs text-gray-500 mt-4 pt-4 border-t border-gray-200",children:["Generated: ",new Date(j.created_at).toLocaleString()]})]})}),e.jsx(b,{children:e.jsxs(y,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3",children:[e.jsxs(v,{onClick:()=>window.location.hash="#/admin?tab=fleet",variant:"secondary",className:"w-full justify-start",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"View All Issues"]}),e.jsxs(v,{onClick:()=>window.location.hash="#/admin?tab=inventory",variant:"secondary",className:"w-full justify-start",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Manage Inventory"]}),e.jsxs(v,{onClick:()=>window.location.hash="#/admin?tab=apparatus-status",variant:"secondary",className:"w-full justify-start",children:[e.jsx(se,{className:"w-4 h-4 mr-2"}),"Fleet Status"]}),e.jsxs(v,{onClick:ae,disabled:h,className:"w-full justify-start",children:[e.jsx(te,{className:`w-4 h-4 mr-2 ${h?"animate-spin":""}`}),"Refresh Data"]})]})]})}),o.length===0&&!p&&e.jsx(b,{children:e.jsxs(y,{className:"py-12 text-center",children:[e.jsx(V,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"Fleet Operating Optimally"}),e.jsx("p",{className:"text-gray-600",children:"No critical issues or actionable insights at this time."}),e.jsxs(v,{onClick:ae,variant:"secondary",className:"mt-4",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Refresh Analysis"]})]})})]})},Bs=({adminPassword:x,onCriticalAlertCount:m})=>{const[c,h]=r.useState(null),[g,k]=r.useState(!1),[n,o]=r.useState(null),[d,i]=r.useState("week"),[C,I]=r.useState("all"),a=async()=>{if(!x){o("Admin authentication required");return}k(!0),o(null);try{const l=C==="all"?void 0:C,p=await z.getAIInsights(x,d,l);h(p);const A=p.insights.filter(f=>f.toLowerCase().includes("critical")||f.toLowerCase().includes("immediate")||f.toLowerCase().includes("urgent")).length;m&&m(A)}catch(l){console.error("Error loading AI insights:",l),o(l.message||"Failed to load AI insights")}finally{k(!1)}},j=(l,p)=>{const A=l.toLowerCase().includes("critical")||l.toLowerCase().includes("urgent"),f=l.toLowerCase().includes("warning")||l.toLowerCase().includes("attention"),w=l.toLowerCase().includes("good")||l.toLowerCase().includes("excellent")||l.toLowerCase().includes("optimal");let $="bg-blue-50",F="border-blue-200",L="text-blue-800",O=e.jsx(V,{className:"w-5 h-5 text-blue-600"});return A?($="bg-red-50",F="border-red-200",L="text-red-800",O=e.jsx(U,{className:"w-5 h-5 text-red-600"})):f?($="bg-yellow-50",F="border-yellow-200",L="text-yellow-800",O=e.jsx(U,{className:"w-5 h-5 text-yellow-600"})):w&&($="bg-green-50",F="border-green-200",L="text-green-800",O=e.jsx(V,{className:"w-5 h-5 text-green-600"})),e.jsxs("div",{className:`flex items-start gap-3 p-4 ${$} rounded-lg border ${F}`,children:[O,e.jsx("p",{className:`text-sm font-medium ${L} flex-1`,children:l})]},p)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[e.jsx(Y,{className:"w-7 h-7 text-blue-600"}),"Fleet Insights - AI Analysis"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1 flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4 text-purple-600"}),"Powered by Cloudflare Workers AI (Llama 3 8B)"]})]}),e.jsxs(v,{onClick:a,disabled:g,variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(te,{className:`w-4 h-4 ${g?"animate-spin":""}`}),"Refresh Analysis"]})]}),e.jsx(b,{children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Analysis Timeframe"}),e.jsx("div",{className:"flex gap-2",children:[{value:"week",label:"Last Week"},{value:"month",label:"Last Month"},{value:"all",label:"All Time"}].map(({value:l,label:p})=>e.jsx("button",{onClick:()=>i(l),className:`flex-1 px-4 py-2 rounded-lg font-medium transition-all ${d===l?"bg-blue-600 text-white shadow-md":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:p},l))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Filter by Apparatus"}),e.jsxs("select",{value:C,onChange:l=>I(l.target.value),className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"all",children:"All Apparatus"}),Ze.map(l=>e.jsx("option",{value:l,children:l},l))]})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs(v,{onClick:a,disabled:g,className:"w-full md:w-auto flex items-center gap-2",children:[e.jsx(Y,{className:"w-5 h-5"}),g?"Analyzing Fleet...":"Analyze Fleet"]})})]})}),g&&e.jsx(b,{children:e.jsx(y,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mb-4 animate-pulse",children:e.jsx(Qe,{className:"w-8 h-8 text-white"})}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"AI Analysis in Progress"}),e.jsx("p",{className:"text-gray-600",children:"Analyzing inspection data and generating insights..."}),e.jsx("div",{className:"mt-4 w-48 h-2 bg-gray-200 rounded-full mx-auto overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-blue-500 to-purple-600 animate-pulse"})})]})})}),n&&!g&&e.jsx(b,{className:"border-red-300",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(U,{className:"w-6 h-6 text-red-600 flex-shrink-0 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-red-900 mb-2",children:"Analysis Unavailable"}),e.jsx("p",{className:"text-red-700 text-sm mb-4",children:n}),n.includes("503")||n.includes("enabled")?e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-sm text-red-800",children:[e.jsx("p",{className:"font-semibold mb-2",children:"AI service is temporarily unavailable."}),e.jsx("p",{children:"This could be due to:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Cloudflare Workers AI service maintenance"}),e.jsx("li",{children:"AI features not configured in the worker"}),e.jsx("li",{children:"Network connectivity issues"})]}),e.jsx("p",{className:"mt-3 font-medium",children:"You can still view raw data in other dashboard tabs."})]}):e.jsx(v,{onClick:a,variant:"secondary",children:"Try Again"})]})]})})}),!c&&!g&&!n&&e.jsx(b,{children:e.jsxs(y,{className:"py-12 text-center",children:[e.jsx(Y,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:"No Analysis Data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No inspection data available for this timeframe."}),e.jsx("p",{className:"text-sm text-gray-500",children:"Try expanding the timeframe or checking other apparatus."})]})}),c&&!g&&e.jsxs("div",{className:"space-y-6",children:[e.jsx(b,{className:"border-blue-300 bg-gradient-to-br from-blue-50 to-purple-50",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-600 to-purple-600 p-3 rounded-full",children:e.jsx(Ne,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Analysis Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Data Points"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.dataPoints})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Timeframe"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900 capitalize",children:c.timeframe})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Apparatus"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.apparatus||"All"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Insights Found"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:c.insights.length})]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Generated at: ",new Date(c.generatedAt).toLocaleString()]})]})]})})}),e.jsx(b,{children:e.jsxs(y,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-5 h-5 text-orange-600"}),"AI-Generated Insights"]}),c.insights.length>0?e.jsx("div",{className:"space-y-3",children:c.insights.map((l,p)=>j(l,p))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(V,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"Fleet Operating Optimally"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"AI analysis found no issues or recommendations at this time."})]})]})}),e.jsx(b,{children:e.jsxs(y,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-green-600"}),"Fleet Health Score"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Overall Fleet Health"}),e.jsxs("span",{className:`text-lg font-bold ${c.dataPoints>0?"text-green-600":"text-gray-500"}`,children:[c.dataPoints>0?Math.max(70,100-c.insights.length*5):0,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3",children:e.jsx("div",{className:"h-3 rounded-full bg-gradient-to-r from-green-500 to-emerald-600 transition-all duration-500",style:{width:`${c.dataPoints>0?Math.max(70,100-c.insights.length*5):0}%`}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Critical"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:c.insights.filter(l=>l.toLowerCase().includes("critical")).length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Warnings"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:c.insights.filter(l=>l.toLowerCase().includes("warning")).length})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Recommendations"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:c.insights.filter(l=>!l.toLowerCase().includes("critical")&&!l.toLowerCase().includes("warning")).length})]})]})]})]})})]})]})},Gs=({items:x,isLoading:m,error:c,onRefresh:h})=>{const[g,k]=r.useState(""),[n,o]=r.useState("name"),[d,i]=r.useState("asc"),C=r.useMemo(()=>{let a=x;if(g){const j=g.toLowerCase();a=a.filter(l=>l.equipmentName.toLowerCase().includes(j)||l.equipmentType.toLowerCase().includes(j)||l.location?.toLowerCase().includes(j)||l.description?.toLowerCase().includes(j))}return a=[...a].sort((j,l)=>{let p=0;switch(n){case"name":p=j.equipmentName.localeCompare(l.equipmentName);break;case"quantity":p=j.quantity-l.quantity;break;case"location":p=(j.location||"").localeCompare(l.location||"");break}return d==="asc"?p:-p}),a},[x,g,n,d]),I=a=>{n===a?i(d==="asc"?"desc":"asc"):(o(a),i("asc"))};return c?e.jsx(b,{className:"border-red-300",children:e.jsxs(y,{className:"py-8 text-center",children:[e.jsx(U,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Error Loading Inventory"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:c}),e.jsx(v,{onClick:h,variant:"secondary",children:"Try Again"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white rounded-lg shadow-sm border border-gray-200 p-4 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(qs,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search inventory...",value:g,onChange:a=>k(a.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none text-base"})]}),e.jsx(v,{onClick:h,variant:"secondary",className:"flex-shrink-0 min-w-[44px] min-h-[44px] flex items-center justify-center",disabled:m,"aria-label":"Refresh inventory",children:e.jsx(te,{className:`w-5 h-5 ${m?"animate-spin":""}`})})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>I("name"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-colors ${n==="name"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Name ",n==="name"&&(d==="asc"?"â†‘":"â†“")]}),e.jsxs("button",{onClick:()=>I("quantity"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-colors ${n==="quantity"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Quantity ",n==="quantity"&&(d==="asc"?"â†‘":"â†“")]}),e.jsxs("button",{onClick:()=>I("location"),className:`px-3 py-2 rounded-lg text-sm font-semibold transition-colors ${n==="location"?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["Location ",n==="location"&&(d==="asc"?"â†‘":"â†“")]})]})]}),m?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading inventory..."})]}):C.length===0?e.jsx(b,{children:e.jsxs(y,{className:"py-12 text-center",children:[e.jsx(B,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:g?"No items found":"No inventory items"}),e.jsx("p",{className:"text-gray-600 mt-1",children:g?"Try adjusting your search terms":"Inventory list is empty"})]})}):e.jsx("div",{className:"space-y-3",children:C.map(a=>{const j=a.minQty&&a.quantity<=a.minQty;return e.jsx(b,{className:`hover:shadow-md transition-shadow ${j?"border-orange-300":""}`,children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(B,{className:`w-5 h-5 flex-shrink-0 ${j?"text-orange-600":"text-blue-600"}`}),e.jsx("h3",{className:"font-bold text-gray-900 truncate",children:a.equipmentName}),j&&e.jsx(U,{className:"w-4 h-4 text-orange-600 flex-shrink-0"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Type:"})," ",a.equipmentType]}),a.location&&e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Location:"})," ",a.location," (Shelf ",a.shelf,", Row ",a.row,")"]}),a.manufacturer&&e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Mfg:"})," ",a.manufacturer]}),a.description&&e.jsx("p",{className:"text-gray-500 text-xs mt-2 line-clamp-2",children:a.description})]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right",children:[e.jsx("div",{className:`text-3xl font-bold ${j?"text-orange-600":"text-blue-600"}`,children:a.quantity}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:a.minQty?`Min: ${a.minQty}`:"in stock"}),j&&e.jsx("div",{className:"text-xs font-semibold text-orange-600 mt-1",children:"LOW STOCK"})]})]})})},a.id)})}),!m&&C.length>0&&e.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:["Showing ",C.length," of ",x.length," items"]})]})},Ws=()=>{const[x,m]=r.useState("pending"),{tasks:c,isLoading:h,error:g,completeTask:k,cancelTask:n,refresh:o}=ve(x),[d,i]=r.useState(null),C=async(a,j)=>{if(confirm(`Mark "${j}" task as completed?`)){i(a);try{await k(a,void 0,"Admin","Completed from dashboard"),alert("Task marked as completed successfully")}catch(l){alert(`Error: ${l instanceof Error?l.message:"Failed to complete task"}`)}finally{i(null)}}},I=async(a,j)=>{const l=prompt(`Cancel "${j}" task? Enter reason (optional):`);if(l!==null){i(a);try{await n(a,l||"Canceled from dashboard"),alert("Task canceled successfully")}catch(p){alert(`Error: ${p instanceof Error?p.message:"Failed to cancel task"}`)}finally{i(null)}}};return g?e.jsx(b,{className:"border-red-300",children:e.jsxs(y,{className:"py-8 text-center",children:[e.jsx(Q,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 font-semibold mb-2",children:"Error Loading Tasks"}),e.jsx("p",{className:"text-gray-600 text-sm mb-4",children:g}),e.jsx(v,{onClick:o,variant:"secondary",children:"Try Again"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 border-b border-gray-200 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>m("pending"),className:`px-4 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap min-w-[120px] ${x==="pending"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(je,{className:"w-5 h-5"}),"Pending"]}),e.jsxs("button",{onClick:()=>m("completed"),className:`px-4 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap min-w-[120px] ${x==="completed"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(V,{className:"w-5 h-5"}),"Completed"]}),e.jsxs("button",{onClick:()=>m("canceled"),className:`px-4 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap min-w-[120px] ${x==="canceled"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(be,{className:"w-5 h-5"}),"Canceled"]})]}),h?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading tasks..."})]}):c.length===0?e.jsx(b,{children:e.jsxs(y,{className:"py-12 text-center",children:[e.jsx(B,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-lg font-semibold text-gray-900",children:["No ",x," tasks"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:x==="pending"?"All supply tasks are up to date":`No tasks have been ${x}`})]})}):e.jsx("div",{className:"space-y-3",children:c.map(a=>e.jsx(b,{className:"hover:shadow-md transition-shadow",children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:a.apparatus}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${a.deficiencyType==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:a.deficiencyType==="missing"?"âŒ Missing":"âš ï¸ Damaged"})]}),e.jsx("h3",{className:"font-bold text-gray-900 text-lg",children:a.itemName}),a.compartment&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Compartment: ",a.compartment]})]}),x==="pending"&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(je,{className:"w-6 h-6 text-orange-600"})}),x==="completed"&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(V,{className:"w-6 h-6 text-green-600"})}),x==="canceled"&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(be,{className:"w-6 h-6 text-gray-600"})})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Created by:"})," ",a.createdBy]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Created:"})," ",ye(a.createdAt)]}),a.completedBy&&a.completedAt&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Completed by:"})," ",a.completedBy]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Completed:"})," ",ye(a.completedAt)]})]}),a.notes&&e.jsxs("p",{className:"text-gray-700 bg-gray-50 p-2 rounded mt-2",children:[e.jsx("span",{className:"font-semibold",children:"Notes:"})," ",a.notes]})]}),x==="pending"&&e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(v,{onClick:()=>C(a.id,a.itemName),variant:"primary",size:"sm",className:"flex-1 min-h-[44px]",disabled:d===a.id,children:d===a.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Mark Complete"]})}),e.jsxs(v,{onClick:()=>I(a.id,a.itemName),variant:"secondary",size:"sm",className:"flex-1 min-h-[44px] bg-red-50 hover:bg-red-100 text-red-700",disabled:d===a.id,children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Cancel"]})]})]})})},a.id))}),!h&&c.length>0&&e.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:[c.length," ",x," task",c.length!==1?"s":""]})]})},Qs=()=>{const{tasks:x,isLoading:m}=ve("pending"),{items:c,isLoading:h}=Ae(),g=m||h,k=is.useMemo(()=>x.map(n=>{const o=[];if(n.suggestedReplacements&&n.suggestedReplacements.length>0)return{task:n,suggestions:n.suggestedReplacements.map(i=>({...i,inStock:i.qtyOnHand>0}))};const d=n.itemName.toLowerCase();return c.forEach(i=>{const C=i.equipmentName.toLowerCase(),I=i.equipmentType.toLowerCase();let a=0;C.includes(d)||d.includes(C)?a=.8:(I.includes(d)||d.includes(I))&&(a=.6),a>0&&o.push({itemId:i.id,itemName:i.equipmentName,qtyOnHand:i.quantity,location:i.location,confidence:a,inStock:i.quantity>0})}),o.sort((i,C)=>i.inStock&&!C.inStock?-1:!i.inStock&&C.inStock?1:(C.confidence||0)-(i.confidence||0)),{task:n,suggestions:o.slice(0,3)}}),[x,c]);return g?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading suggestions..."})]}):x.length===0?e.jsx(b,{children:e.jsxs(y,{className:"py-12 text-center",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Pending Tasks"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Suggestions will appear when there are pending supply tasks"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-900 font-semibold",children:"Inventory Suggestions"}),e.jsx("p",{className:"text-sm text-blue-800 mt-1",children:"Suggested replacements from inventory for pending tasks. Match confidence and stock availability shown."})]})]})}),k.map(({task:n,suggestions:o})=>e.jsx(b,{className:"hover:shadow-md transition-shadow",children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:n.apparatus}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-semibold ${n.deficiencyType==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:n.deficiencyType==="missing"?"Missing":"Damaged"})]}),e.jsx("h3",{className:"font-bold text-gray-900",children:n.itemName}),n.compartment&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Compartment: ",n.compartment]})]}),o.length===0?e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg text-center",children:[e.jsx(Q,{className:"w-6 h-6 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No matching items found in inventory"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Suggested Replacements:"}),o.map((d,i)=>e.jsx("div",{className:`p-3 rounded-lg border-2 ${d.inStock?"bg-green-50 border-green-300":"bg-gray-50 border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(B,{className:`w-4 h-4 ${d.inStock?"text-green-600":"text-gray-400"}`}),e.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:d.itemName})]}),d.location&&e.jsxs("p",{className:"text-xs text-gray-600",children:["Location: ",d.location]}),d.confidence&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Match: ",Math.round(d.confidence*100),"%"]})]}),e.jsxs("div",{className:"flex-shrink-0 text-right",children:[e.jsx("div",{className:`text-2xl font-bold ${d.inStock?"text-green-600":"text-gray-400"}`,children:d.qtyOnHand}),e.jsx("div",{className:`text-xs font-semibold ${d.inStock?"text-green-600":"text-gray-500"}`,children:d.inStock?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"w-3 h-3"}),"IN STOCK"]}):"OUT OF STOCK"})]})]})},`${d.itemId}-${i}`))]}),o.some(d=>d.inStock)&&e.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-900",children:["ðŸ’¡ ",e.jsx("strong",{children:"Tip:"})," When marking this task as complete in the Tasks tab, you can select one of these items as the replacement to automatically update inventory."]})})]})})},n.id)),e.jsxs("div",{className:"text-center text-sm text-gray-600 py-2",children:[k.length," task",k.length!==1?"s":""," with suggestions"]})]})};function Ks({inventory:x,tasks:m}){const[c,h]=r.useState(!1),[g,k]=r.useState([]),[n,o]=r.useState(!1),[d,i]=r.useState(null),[C,I]=r.useState(!1);r.useEffect(()=>{a()},[]);async function a(){o(!0),i(null);try{const f=await Ye();k(f.insights)}catch(f){console.error("Failed to load insights:",f),i(f instanceof Error?f.message:"Failed to load insights")}finally{o(!1)}}async function j(){h(!0),i(null),I(!1);try{const f=await Xe({tasks:m.filter(w=>w.status==="pending"),inventory:x});f.ok?setTimeout(()=>{a()},2e3):(I(!0),i(f.message))}catch(f){console.error("Failed to generate insights:",f),i(f instanceof Error?f.message:"Failed to generate insights")}finally{h(!1)}}function l(f){try{return JSON.parse(f)}catch{return null}}const p=g.length>0?g[0]:null,A=p?l(p.insight_json):null;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3 flex-wrap",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"AI Insights"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Automated inventory analysis and recommendations"})]}),e.jsx(v,{onClick:j,disabled:c||x.length===0,className:"min-h-[44px] whitespace-nowrap",children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"animate-spin mr-2",children:"âš™ï¸"}),"Generating..."]}):"ðŸ¤– Generate Insights"})]}),d&&e.jsx("div",{className:`p-4 rounded-lg ${C?"bg-yellow-50 border border-yellow-200":"bg-red-50 border border-red-200"}`,children:e.jsx("p",{className:`text-sm ${C?"text-yellow-800":"text-red-800"}`,children:C?e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"âš ï¸ AI Not Configured:"})," ",d,e.jsx("br",{}),e.jsx("span",{className:"text-xs mt-1 block",children:"This is an optional feature. The system works fully without it."})]}):e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:"Error:"})," ",d]})})}),n&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin text-4xl",children:"âš™ï¸"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Loading insights..."})]}),!n&&p&&A&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Generated: ",new Date(p.created_at).toLocaleString(),p.model&&e.jsxs("span",{className:"ml-2",children:["â€¢ Model: ",p.model.split("/").pop()]})]}),A.summary&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ“Š Summary"}),e.jsx("p",{className:"text-blue-800 text-sm",children:A.summary})]}),A.recurringIssues&&A.recurringIssues.length>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-orange-900 mb-2",children:"ðŸ”„ Recurring Issues"}),e.jsx("ul",{className:"space-y-1",children:A.recurringIssues.map((f,w)=>e.jsxs("li",{className:"text-orange-800 text-sm",children:["â€¢ ",f]},w))})]}),A.reorderSuggestions&&A.reorderSuggestions.length>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-green-900 mb-2",children:"ðŸ“¦ Reorder Suggestions"}),e.jsx("div",{className:"space-y-3",children:A.reorderSuggestions.map((f,w)=>e.jsx("div",{className:"bg-white rounded p-3 border border-green-100",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-green-900 text-sm",children:f.item}),e.jsx("p",{className:"text-green-700 text-xs mt-1",children:f.reason})]}),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium whitespace-nowrap ${f.urgency?.toLowerCase()==="high"?"bg-red-100 text-red-800":f.urgency?.toLowerCase()==="medium"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:f.urgency||"Normal"})]})},w))})]}),A.anomalies&&A.anomalies.length>0&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-2",children:"ðŸ” Anomalies Detected"}),e.jsx("ul",{className:"space-y-1",children:A.anomalies.map((f,w)=>e.jsxs("li",{className:"text-purple-800 text-sm",children:["â€¢ ",f]},w))})]})]}),!n&&g.length===0&&!d&&e.jsxs("div",{className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ¤–"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"No insights generated yet"}),e.jsx("p",{className:"text-gray-500 text-sm mt-2",children:'Click "Generate Insights" to analyze your inventory'})]}),g.length>1&&e.jsxs("div",{className:"text-xs text-gray-500 text-center pt-2 border-t border-gray-200",children:[g.length," insights stored â€¢ Showing most recent"]})]})}const Js=()=>{const[x,m]=r.useState("list"),{items:c,isLoading:h,error:g,refresh:k,lastFetchedAt:n}=Ae(),{tasks:o}=ve();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Inventory Management"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Manage supply inventory, tasks, and suggested replacements"})]}),n&&!h&&e.jsxs("div",{className:"text-sm text-gray-500",children:["Last updated: ",new Date(n).toLocaleString()]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-gray-200 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>m("list"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${x==="list"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(B,{className:"w-5 h-5"}),"Inventory List"]}),e.jsxs("button",{onClick:()=>m("tasks"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${x==="tasks"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(ws,{className:"w-5 h-5"}),"Supply Tasks"]}),e.jsxs("button",{onClick:()=>m("suggestions"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${x==="suggestions"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(fe,{className:"w-5 h-5"}),"Suggestions"]}),e.jsxs("button",{onClick:()=>m("ai-insights"),className:`px-6 py-3 font-semibold transition-all flex items-center gap-2 whitespace-nowrap ${x==="ai-insights"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Y,{className:"w-5 h-5"}),"AI Insights"]})]}),e.jsxs("div",{className:"mt-6",children:[x==="list"&&e.jsx(Gs,{items:c,isLoading:h,error:g,onRefresh:k}),x==="tasks"&&e.jsx(Ws,{}),x==="suggestions"&&e.jsx(Qs,{}),x==="ai-insights"&&e.jsx(Ks,{inventory:c,tasks:o})]})]})};function Xs(x={}){const{status:m,pollInterval:c=3e4,autoFetch:h=!0}=x,[g,k]=r.useState([]),[n,o]=r.useState(h),[d,i]=r.useState(null),[C,I]=r.useState(0),[a,j]=r.useState(0),l=r.useCallback(async()=>{o(!0),i(null);try{const w=await ds(m);k(w.requests),I(w.pending),j(w.total)}catch(w){console.error("Error fetching vehicle change requests:",w),i(w instanceof Error?w.message:"Failed to fetch vehicle change requests")}finally{o(!1)}},[m]),p=async w=>{try{await xs(w),await l()}catch($){throw console.error("Error submitting vehicle change request:",$),$}},A=async(w,$,F)=>{try{await Be(w,"approve",$,F),await l()}catch(L){throw console.error("Error approving vehicle change request:",L),L}},f=async(w,$,F)=>{try{await Be(w,"reject",$,F),await l()}catch(L){throw console.error("Error rejecting vehicle change request:",L),L}};return r.useEffect(()=>{h&&l()},[l,h]),r.useEffect(()=>{if(c>0){const w=setInterval(l,c);return()=>clearInterval(w)}},[c,l]),{requests:g,loading:n,error:d,pendingCount:C,totalCount:a,refetch:l,submitRequest:p,approveRequest:A,rejectRequest:f}}const Ys=()=>{const{statuses:x,allVehicles:m,loading:c,error:h,refetch:g}=Je(),{requests:k,loading:n,pendingCount:o,approveRequest:d,rejectRequest:i,refetch:C}=Xs({pollInterval:3e4}),[I,a]=r.useState(null),[j,l]=r.useState(!1),[p,A]=r.useState(null),[f,w]=r.useState(""),$=async t=>{if(confirm("Approve this vehicle change? This will update the Google Sheet.")){a(t);try{await d(t,"Admin","Approved by admin dashboard"),alert("Vehicle change approved and sheet updated!"),await g()}catch(M){console.error("Error approving request:",M),alert("Failed to approve request. Please try again.")}finally{a(null)}}},F=async()=>{if(p){a(p);try{await i(p,"Admin",f||"Rejected by admin"),alert("Vehicle change request rejected."),l(!1),A(null),w("")}catch(t){console.error("Error rejecting request:",t),alert("Failed to reject request. Please try again.")}finally{a(null)}}},L=t=>{A(t),l(!0)};if(c||n)return e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-600 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-semibold",children:"Loading apparatus status..."})]})});if(h)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border-2 border-red-300 rounded-xl p-6 text-center",children:[e.jsx(U,{className:"w-12 h-12 text-red-600 mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-bold text-red-900 mb-2",children:"Error Loading Apparatus Status"}),e.jsx("p",{className:"text-red-700 mb-4",children:h}),e.jsxs(v,{onClick:g,variant:"secondary",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Retry"]})]})});const O=t=>x.find(Z=>Z.vehicleNo===t)?.unit||null,T=t=>t.toLowerCase().includes("out of service")?"border-2 border-red-500 bg-red-50 hover:border-red-600":"border-2 border-gray-300 bg-white hover:border-blue-400",K=t=>{const M=t.toLowerCase();return M.includes("out of service")?"bg-red-600 text-white":M.includes("in service")?"bg-green-600 text-white":"bg-gray-600 text-white"};return e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Fleet Status"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"All vehicles and current assignments"})]}),e.jsxs(v,{onClick:()=>{g(),C()},variant:"secondary",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Refresh"]})]}),o>0&&e.jsx("div",{className:"bg-amber-50 border-2 border-amber-400 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(je,{className:"w-6 h-6 text-amber-700 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-amber-900 mb-1",children:[o," Pending Vehicle Change Request",o!==1?"s":""]}),e.jsx("p",{className:"text-sm text-amber-800",children:"Review and approve/reject vehicle changes reported by field personnel below."})]})]})}),e.jsxs(b,{children:[e.jsx(Ge,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-6 h-6 text-blue-700"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"All Vehicles"})]})}),e.jsxs(y,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(t=>{const M=O(t.vehicleNo),Z=t.status.toLowerCase().includes("out of service");return e.jsxs("div",{className:`${T(t.status)} rounded-lg p-4 transition-colors`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"text-3xl font-bold text-blue-700",children:["#",t.vehicleNo]}),M&&e.jsx("p",{className:"text-lg font-semibold text-gray-900 mt-1",children:M}),!M&&t.designation&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.designation})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded ${K(t.status)}`,children:t.status})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[t.assignment&&e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Assignment:"})," ",t.assignment]}),t.currentLocation&&e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Location:"})," ",t.currentLocation]}),t.notes&&e.jsx("p",{className:`text-xs italic mt-2 ${Z?"text-red-700 font-semibold":"text-gray-500"}`,children:t.notes})]}),!M&&!t.designation&&e.jsx("div",{className:"mt-2 pt-2 border-t border-gray-300",children:e.jsx("span",{className:"text-xs font-semibold text-gray-500 uppercase",children:"Reserve"})})]},t.vehicleNo)})}),m.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No vehicle data available"})]})]}),e.jsxs(b,{children:[e.jsx(Ge,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-6 h-6 text-orange-700"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Vehicle Change Requests"})]})}),e.jsxs(y,{children:[e.jsxs("div",{className:"space-y-4",children:[k.filter(t=>t.status==="pending").map(t=>e.jsx("div",{className:"border-2 border-orange-300 rounded-lg p-4 bg-orange-50",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-bold text-gray-900 text-lg",children:t.apparatus}),e.jsx("span",{className:"px-2 py-1 text-xs font-bold bg-orange-200 text-orange-900 rounded",children:"PENDING"})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Old Vehicle:"})," #",t.oldVehicleNo||"None"," â†’ ",e.jsx("span",{className:"font-semibold",children:"New Vehicle:"})," #",t.newVehicleNo]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Reported by:"})," ",t.reportedBy]}),e.jsxs("p",{className:"text-gray-600",children:[e.jsx("span",{className:"font-semibold",children:"Date:"})," ",new Date(t.reportedAt).toLocaleString()]}),t.notes&&e.jsx("p",{className:"text-gray-500 italic mt-2",children:t.notes})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(v,{onClick:()=>$(t.id),disabled:I===t.id,className:"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(V,{className:"w-4 h-4"}),"Approve"]}),e.jsxs(v,{onClick:()=>L(t.id),disabled:I===t.id,variant:"secondary",className:"flex items-center gap-2 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-900",children:[e.jsx(be,{className:"w-4 h-4"}),"Reject"]})]})]})},t.id)),k.filter(t=>t.status==="pending").length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No pending vehicle change requests"})]}),k.filter(t=>t.status!=="pending").length>0&&e.jsxs("div",{className:"mt-8 pt-6 border-t-2 border-gray-200",children:[e.jsx("h4",{className:"font-bold text-gray-700 mb-4",children:"Recently Processed"}),e.jsx("div",{className:"space-y-3",children:k.filter(t=>t.status!=="pending").slice(0,5).map(t=>e.jsx("div",{className:"border border-gray-300 rounded-lg p-3 bg-gray-50 text-sm",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-900",children:t.apparatus}),e.jsx("span",{className:`px-2 py-0.5 text-xs font-bold rounded ${t.status==="approved"?"bg-green-200 text-green-900":"bg-red-200 text-red-900"}`,children:t.status.toUpperCase()})]}),e.jsxs("p",{className:"text-gray-600 text-xs",children:["#",t.oldVehicleNo||"None"," â†’ #",t.newVehicleNo," â€¢ Reported by ",t.reportedBy]}),t.reviewedBy&&e.jsxs("p",{className:"text-gray-500 text-xs mt-1",children:["Reviewed by ",t.reviewedBy," on"," ",new Date(t.reviewedAt).toLocaleString()]})]})})},t.id))})]})]})]}),j&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-4",children:"Reject Vehicle Change Request"}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Provide a reason for rejecting this vehicle change request:"}),e.jsx("textarea",{value:f,onChange:t=>w(t.target.value),placeholder:"Enter reason for rejection...",className:"w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none mb-4",rows:4}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(v,{onClick:()=>{l(!1),A(null),w("")},variant:"secondary",className:"flex-1",children:"Cancel"}),e.jsx(v,{onClick:F,disabled:I===p,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:"Confirm Reject"})]})]})})]})},tt=()=>{const x=cs(),[m,c]=r.useState(!1),[h,g]=r.useState(""),[k,n]=r.useState(""),[o,d]=r.useState("home"),[i,C]=r.useState(new Map),[I,a]=r.useState([]),[j,l]=r.useState(null),[p,A]=r.useState([]),[f,w]=r.useState(!1),[$,F]=r.useState([]),[L,O]=r.useState(null),[T,K]=r.useState(!1),[t,M]=r.useState(null),[Z,ae]=r.useState(!1),[ee,N]=r.useState(!1),[_,q]=r.useState(null),[D,G]=r.useState(0),[ne,oe]=r.useState(0),[re,P]=r.useState(null),[E,de]=r.useState(null),[Le,ie]=r.useState(""),[ce,$e]=r.useState(!1),[xe,es]=r.useState(""),[we,ss]=r.useState(null),[me,_e]=r.useState("defects"),[ke,Me]=r.useState(!1),Re=async s=>{try{K(!0),O(s),d("activity");const S=(await z.getInspectionLogs(30)).filter(H=>H.title.includes(`[${s}]`));F(S)}catch(u){console.error("Error loading apparatus logs:",u),alert("Failed to load inspection history")}finally{K(!1)}},he=async()=>{try{K(!0),O(null);const s=await z.getInspectionLogs(30);F(s)}catch(s){console.error("Error loading all inspection logs:",s)}finally{K(!1)}},Te=async()=>{try{w(!0);const s=await z.getAllDefects(),u=z.computeFleetStatus(s);C(u),a(s);try{const S=await z.getDailySubmissions();l(S)}catch(S){console.error("Error fetching daily submissions:",S)}try{const S=await z.analyzeLowStockItems();A(S)}catch(S){console.error("Error analyzing low stock:",S)}try{const S=await Ke("pending");oe(S.unseenCount)}catch(S){console.error("Error fetching unseen inventory count:",S)}}catch(s){throw console.error("Error loading dashboard data:",s),s instanceof Error&&s.message.includes("Unauthorized")&&(c(!1),z.clearAdminPassword(),localStorage.removeItem("adminPassword")),s}finally{w(!1)}},Ee=async()=>{if(!h.trim()){n("Please enter a password");return}z.setAdminPassword(h),localStorage.setItem("adminPassword",h);try{await Te(),c(!0),n("")}catch(s){console.error("Authentication failed:",s),s instanceof Error&&s.message.includes("Unauthorized")?n("Incorrect password. Please try again."):s instanceof Error&&s.message.includes("Failed to fetch")?n("Network error. Please check your connection and try again."):n("Authentication failed. Please try again."),z.clearAdminPassword(),localStorage.removeItem("adminPassword")}},De=async()=>{if(h){ae(!0),q(null);try{const s=await z.getEmailConfig(h);M(s)}catch(s){q(s.message||"Failed to load email configuration")}finally{ae(!1)}}},W=async s=>{if(!(!h||!t)){N(!0),q(null);try{const u=await z.updateEmailConfig(h,s);M(u.config),alert("Email configuration updated successfully")}catch(u){q(u.message||"Failed to update email configuration")}finally{N(!1)}}},ts=async()=>{if(h&&confirm("Send a test daily digest email now?"))try{await z.sendManualDigest(h),alert("Test digest sent successfully! Check your email.")}catch(s){alert("Failed to send test digest: "+(s.message||"Unknown error"))}},as=async()=>{if(!(!E||!E.issueNumber)){$e(!0);try{await z.resolveDefect(E.issueNumber,Le||"Defect resolved via Admin Dashboard","Admin"),a(s=>s.filter(u=>u.issueNumber!==E.issueNumber)),C(s=>{const u=new Map(s),S=u.get(E.apparatus)||0;return u.set(E.apparatus,Math.max(0,S-1)),u}),de(null),ie(""),alert("Defect successfully resolved!")}catch(s){console.error("Error resolving defect:",s),alert(`Failed to resolve defect: ${s instanceof Error?s.message:"Unknown error"}`)}finally{$e(!1)}}},J=async s=>{if(d(s),Me(!1),s==="inventory"&&ne>0)try{await ms(),oe(0)}catch(u){console.error("Error marking tasks as viewed:",u)}s==="notifications"&&!t&&De(),s==="insights"&&G(0)};if(r.useEffect(()=>{if(!m)return;const s=setInterval(()=>{Te().catch(console.error)},12e4);return()=>clearInterval(s)},[m]),r.useEffect(()=>{m&&o==="activity"&&$.length===0&&!T&&he()},[m,o]),!m)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center p-4",children:e.jsx(b,{className:"max-w-md w-full",children:e.jsxs(y,{className:"py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-2xl mb-4",children:e.jsx(_s,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Admin Access Required"}),e.jsx("p",{className:"text-gray-600",children:"Enter the admin password to continue"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Password"}),e.jsx("input",{id:"password",type:"password",value:h,onChange:s=>{g(s.target.value),n("")},onKeyDown:s=>{s.key==="Enter"&&Ee()},placeholder:"Enter admin password",className:"w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all",autoFocus:!0}),k&&e.jsx("p",{className:"text-red-600 text-sm mt-2",children:k})]}),e.jsx(v,{onClick:Ee,className:"w-full",size:"lg",children:"Access Admin Dashboard"}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{onClick:()=>x("/"),className:"text-sm text-gray-600 hover:text-gray-900 font-medium",children:"â† Back to Login"})})]})]})})});if(f)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading dashboard..."})]})});const ge=Ze,rs=new Date().toLocaleDateString("en-US");return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-900 via-blue-800 to-blue-900 border-b border-blue-700 shadow-xl sticky top-0 z-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-xl flex items-center justify-center shadow-lg flex-shrink-0",children:e.jsx("img",{src:"/mbfd-checkout-system/mbfd_logo.jpg",alt:"MBFD",className:"w-full h-full object-contain rounded-lg"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-white truncate",children:"Admin Dashboard"}),e.jsx("p",{className:"text-xs sm:text-sm text-blue-200 mt-0.5 hidden sm:block",children:"MBFD Fleet Management System"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(v,{onClick:()=>x("/"),variant:"secondary",className:"hidden sm:flex items-center gap-2 bg-white/10 hover:bg-white/20 text-white border-white/20",size:"sm",children:[e.jsx(ys,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden lg:inline",children:"Back to Login"})]}),e.jsx("button",{onClick:()=>Me(!ke),className:"sm:hidden p-2 bg-white/10 hover:bg-white/20 rounded-lg transition-colors","aria-label":"Toggle menu",children:ke?e.jsx(We,{className:"w-6 h-6 text-white"}):e.jsx(Ts,{className:"w-6 h-6 text-white"})})]})]}),e.jsx("div",{className:`${ke?"block":"hidden sm:block"}`,children:e.jsxs("div",{className:"flex gap-1 border-b border-blue-700 overflow-x-auto pb-px scrollbar-hide",children:[e.jsx(X,{icon:Ss,label:"Home",isActive:o==="home",onClick:()=>J("home")}),e.jsx(X,{icon:Q,label:"Inspection Issues",badge:I.length,isActive:o==="fleet",onClick:()=>J("fleet")}),e.jsx(X,{icon:ue,label:"Daily Activity",isActive:o==="activity",onClick:()=>J("activity")}),e.jsx(X,{icon:B,label:"Supply Alerts",badge:p.length,isActive:o==="supplies",onClick:()=>J("supplies")}),e.jsx(X,{icon:Hs,label:"Inventory",badge:ne,isActive:o==="inventory",onClick:()=>J("inventory")}),e.jsx(X,{icon:se,label:"Apparatus Status",isActive:o==="apparatus-status",onClick:()=>J("apparatus-status")}),e.jsx(X,{icon:Ie,label:"Notifications",isActive:o==="notifications",onClick:()=>J("notifications")}),e.jsx(X,{icon:Y,label:"AI Insights",badge:D,badgeColor:"red",isActive:o==="insights",onClick:()=>J("insights")})]})})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8",children:[o==="home"&&e.jsx(Us,{adminPassword:h}),o==="fleet"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Equipment & Vehicle Issues by Apparatus / Unit"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:ge.map(s=>{const u=i.get(s)||0,S=u===0;return e.jsx("div",{className:"cursor-pointer hover:scale-105 transition-transform",onClick:()=>Re(s),children:e.jsx(b,{className:S?"border-green-500":"border-red-500",children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx(se,{className:`w-8 h-8 ${S?"text-green-500":"text-red-500"}`}),S?e.jsx(V,{className:"w-6 h-6 text-green-500"}):e.jsx(Q,{className:"w-6 h-6 text-red-500"})]}),e.jsx("h3",{className:"font-bold text-gray-900 mb-1",children:s}),e.jsx("p",{className:`text-sm font-semibold ${S?"text-green-600":"text-red-600"}`,children:S?"âœ“ No Issues":`${u} Issue${u!==1?"s":""}`}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Click to view history"})]})})},s)})})]}),e.jsx("div",{className:"border-b border-gray-200 mb-6",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>_e("defects"),className:`
                    px-6 py-3 font-semibold transition-all flex items-center gap-2 ${me==="defects"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(Q,{className:"w-5 h-5"}),"Open Issues (",I.length,")"]}),e.jsxs("button",{onClick:()=>{_e("history"),$.length===0&&!T&&he()},className:`
                    px-6 py-3 font-semibold transition-all flex items-center gap-2 ${me==="history"?"text-blue-600 border-b-2 border-blue-600":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(ue,{className:"w-5 h-5"}),"Inspection History (Last 30 Days)",L&&e.jsxs("span",{className:"text-sm text-blue-600",children:["- ",L]})]})]})}),me==="defects"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[e.jsx("input",{type:"text",placeholder:"Search defects...",className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",value:xe,onChange:s=>es(s.target.value)}),e.jsxs("select",{value:we||"",onChange:s=>ss(s.target.value||null),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",children:[e.jsx("option",{value:"",children:"All Apparatus"}),ge.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),I.length===0?e.jsx(b,{children:e.jsxs(y,{className:"py-12 text-center",children:[e.jsx(V,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Open Issues"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"All apparatus equipment and inventory are fully operational"})]})}):e.jsx("div",{className:"space-y-3",children:I.filter(s=>(!we||s.apparatus===we)&&(s.item.toLowerCase().includes(xe.toLowerCase())||s.compartment.toLowerCase().includes(xe.toLowerCase())||s.apparatus.toLowerCase().includes(xe.toLowerCase()))).sort((s,u)=>s.apparatus.localeCompare(u.apparatus)||s.compartment.localeCompare(u.compartment)||s.item.localeCompare(u.item)).map(s=>e.jsx(b,{className:"hover:shadow-md transition-shadow",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:s.apparatus}),e.jsx("span",{className:`
                                  px-3 py-1 rounded-full text-sm font-semibold ${s.status==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}
                                `,children:s.status==="missing"?"âŒ Missing":"âš ï¸ Damaged"})]}),e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-1",children:[s.compartment,": ",s.item]}),e.jsxs("p",{className:"text-gray-600 text-sm mb-2",children:["Reported by ",s.reportedBy," on ",ye(s.reportedAt)]}),s.notes&&e.jsx("p",{className:"text-gray-700 text-sm bg-gray-50 p-3 rounded-lg mb-2 break-words",children:s.notes.split(`
`).slice(0,3).join(`
`)}),s.photoUrl&&e.jsx("div",{className:"mt-3",children:e.jsxs("button",{onClick:()=>P(s.photoUrl||null),className:"inline-flex items-center gap-2 px-3 py-2 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded-lg transition-colors border border-blue-200",children:[e.jsx(As,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-semibold",children:"View Photo"})]})})]}),e.jsx("div",{className:"md:text-right flex-shrink-0",children:e.jsxs(v,{onClick:()=>{de(s),ie("")},className:"bg-green-600 hover:bg-green-700",size:"sm",children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),"Resolve"]})})]})})},`${s.apparatus}-${s.item}-${s.issueNumber}`))})]}),me==="history"&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:L&&e.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:["Filtered: ",L]})}),e.jsxs("div",{className:"flex gap-2",children:[L&&e.jsx(v,{onClick:he,variant:"secondary",size:"sm",children:"View All"}),e.jsx(v,{onClick:()=>L?Re(L):he(),variant:"secondary",size:"sm",disabled:T,children:T?"Loading...":"Refresh"})]})]}),T?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Loading inspection logs..."})]}):$.length===0?e.jsx(b,{children:e.jsxs(y,{className:"py-12 text-center",children:[e.jsx(ue,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-600",children:L?`No inspection logs found for ${L} in the last 30 days.`:"No inspection logs found. Click an apparatus card in Fleet Status to view its history."})]})}):e.jsx("div",{className:"space-y-3",children:$.map(s=>{const u=s.title.match(/\[(.+)\]\s+Daily Inspection\s*-\s*(.+)/),S=u?u[1]:"Unknown",H=u?u[2]:ye(s.created_at),le=s.body?.match(/\*\*Conducted By:\*\*\s*(.+?)\s*\((.+?)\)/),Fe=le?le[1]:"Unknown",pe=le?le[2]:"",qe=s.body?.match(/\*\*Total Items Checked:\*\*\s*(\d+)/),ls=qe?parseInt(qe[1]):0,Pe=s.body?.match(/\*\*Issues Found:\*\*\s*(\d+)/),Ce=Pe?parseInt(Pe[1]):0,ze=s.body?.match(/\[View Full Printable Receipt\]\((.+?)\)/),Ve=ze?ze[1]:null,Oe=s.body?.match(/### Issues Reported\n([\s\S]+?)(?:\n\n|$)/),He=Oe?Oe[1].split(`
`).filter(Se=>Se.trim().startsWith("-")):[];return e.jsx(b,{className:"hover:shadow-md transition-shadow",children:e.jsxs(y,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold",children:S}),Ce===0?e.jsxs("span",{className:"px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-semibold flex items-center gap-1",children:[e.jsx(V,{className:"w-4 h-4"}),"All Clear"]}):e.jsxs("span",{className:"px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-semibold flex items-center gap-1",children:[e.jsx(Q,{className:"w-4 h-4"}),Ce," Issue",Ce!==1?"s":""]})]}),e.jsxs("p",{className:"text-sm text-gray-700 mb-1",children:[e.jsx("strong",{children:"Inspector:"})," ",Fe," ",pe&&`(${pe})`]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Date:"})," ",H," â€¢ ",e.jsx("strong",{children:"Items Checked:"})," ",ls]})]}),e.jsxs("div",{className:"text-right text-xs text-gray-500 flex-shrink-0",children:[e.jsx("span",{className:"text-xs text-gray-600",children:Fe})," ",pe&&e.jsxs("span",{className:"text-xs text-gray-600",children:[" (",pe,")"]})]})]}),He.length>0&&e.jsxs("div",{className:"mb-4 bg-red-50 border-l-4 border-red-500 p-3 rounded",children:[e.jsx("p",{className:"text-sm font-semibold text-red-900 mb-2",children:"Reported Issues:"}),e.jsx("ul",{className:"text-sm text-red-800 space-y-1",children:He.map((Se,ns)=>e.jsx("li",{className:"pl-2 break-words",children:Se.replace(/^-\s*/,"")},ns))})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-3 border-t border-gray-200",children:[Ve&&e.jsx("a",{href:Ve,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-1.5 bg-blue-50 hover:bg-blue-100 text-blue-700 rounded text-sm font-semibold transition-colors",children:"ðŸ“‹ View Receipt"}),e.jsx("a",{href:`https://github.com/pdarleyjr/mbfd-checkout-system/issues/${s.number}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm font-semibold transition-colors",children:"View on GitHub â†’"})]})]})},s.number)})})]}),e.jsx(gs,{isOpen:E!==null,onClose:()=>{ce||(de(null),ie(""))},title:"Resolve Defect",children:E&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Apparatus"}),e.jsx("p",{className:"font-semibold text-gray-900",children:E.apparatus})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Defect"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[E.compartment,": ",E.item]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Status"}),e.jsx("span",{className:`
                      inline-block px-3 py-1 rounded-full text-sm font-semibold ${E.status==="missing"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}
                    `,children:E.status==="missing"?"âŒ Missing":"âš ï¸ Damaged"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"resolution-note",className:"block text-sm font-semibold text-gray-700 mb-2",children:"Resolution Notes (Optional)"}),e.jsx("textarea",{id:"resolution-note",value:Le,onChange:s=>ie(s.target.value),placeholder:"Describe how this defect was resolved...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none resize-none",rows:4,disabled:ce})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(v,{onClick:as,className:"flex-1 bg-green-600 hover:bg-green-700",disabled:ce,children:ce?"Resolving...":"Confirm Resolution"}),e.jsx(v,{onClick:()=>{de(null),ie("")},variant:"secondary",disabled:ce,children:"Cancel"})]})]})}),re&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-90 p-4",onClick:()=>P(null),children:[e.jsx("button",{onClick:()=>P(null),className:"absolute top-4 right-4 p-2 bg-white rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx(We,{className:"w-6 h-6 text-gray-900"})}),e.jsx("img",{src:re,alt:"Defect photo",className:"max-w-full max-h-full object-contain rounded-lg shadow-2xl",onClick:s=>s.stopPropagation()})]})]}),o==="activity"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(ue,{className:"w-6 h-6"}),"Daily Activity - ",rs]}),e.jsx(b,{className:"mb-6",children:e.jsxs(y,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Today's Submissions"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-4",children:ge.map(s=>{const u=j?.today.includes(s)||!1;return e.jsxs("div",{className:`p-4 rounded-lg border-2 ${u?"bg-green-50 border-green-500":"bg-gray-50 border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(se,{className:`w-6 h-6 ${u?"text-green-600":"text-gray-400"}`}),u?e.jsx(V,{className:"w-5 h-5 text-green-600"}):e.jsx(Q,{className:"w-5 h-5 text-gray-400"})]}),e.jsx("p",{className:"font-bold text-gray-900",children:s}),e.jsx("p",{className:`text-sm font-semibold ${u?"text-green-600":"text-gray-500"}`,children:u?"âœ“ Submitted":"Pending"})]},s)})})]})}),e.jsx(b,{children:e.jsxs(y,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Submission Statistics (Last 30 Days)"]}),e.jsx("div",{className:"space-y-3",children:ge.map(s=>{const u=j?.totals.get(s)||0,S=j?.lastSubmission.get(s),H=Math.round(u/30*100);return e.jsxs("div",{className:"border-b border-gray-200 pb-3 last:border-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"w-5 h-5 text-blue-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:s})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-2xl font-bold text-blue-600",children:u}),e.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"submissions"})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[H,"% compliance rate"]}),S&&e.jsxs("span",{children:["Last: ",S]})]}),e.jsx("div",{className:"mt-2 w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${H>=80?"bg-green-500":H>=50?"bg-yellow-500":"bg-red-500"}`,style:{width:`${Math.min(H,100)}%`}})})]},s)})})]})})]})}),o==="supplies"&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(U,{className:"w-6 h-6 text-orange-600"}),"Supply Alerts"]}),p.length===0?e.jsx(b,{children:e.jsxs(y,{className:"py-12 text-center",children:[e.jsx(B,{className:"w-12 h-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:"No Supply Concerns"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"All items are adequately stocked"})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-orange-50 border-l-4 border-orange-500 p-4 rounded",children:e.jsxs("p",{className:"text-sm text-orange-800",children:[e.jsx("strong",{children:"Note:"})," Items listed below have been reported missing multiple times across different apparatus in the last 30 days. This may indicate a supply shortage requiring attention."]})}),p.map((s,u)=>e.jsx(b,{className:"border-orange-300",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(U,{className:"w-6 h-6 text-orange-600"}),e.jsxs("h3",{className:"text-lg font-bold text-gray-900",children:[s.compartment,": ",s.item]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsxs("strong",{children:["Reported missing ",s.occurrences," time",s.occurrences!==1?"s":""]})," in the last 30 days"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-700",children:"Affected apparatus:"}),s.apparatus.map(S=>e.jsx("span",{className:"px-2 py-1 bg-orange-100 text-orange-800 rounded text-xs font-semibold",children:S},S))]})]})]}),e.jsx("div",{className:"ml-4",children:e.jsx("span",{className:"inline-flex items-center justify-center w-12 h-12 bg-orange-100 rounded-full",children:e.jsx("span",{className:"text-xl font-bold text-orange-600",children:s.occurrences})})})]})})},u))]})]}),o==="inventory"&&e.jsx(Js,{}),o==="apparatus-status"&&e.jsx(Ys,{}),o==="insights"&&e.jsx(e.Fragment,{children:e.jsx(Bs,{adminPassword:h,onCriticalAlertCount:G})}),o==="notifications"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Email Notifications"}),e.jsxs(v,{onClick:ts,variant:"secondary",className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-5 h-5"}),"Send Test Digest"]})]}),_&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg",children:_}),Z?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading configuration..."})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsx(b,{children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.enabled?"Notifications are currently enabled":"Notifications are currently disabled"})]}),e.jsx(v,{onClick:()=>W({enabled:!t.enabled}),className:t.enabled?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700",disabled:ee,children:t.enabled?"Disable":"Enable"})]})})}),e.jsx(b,{children:e.jsxs(y,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Mode"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"email_mode",value:"daily_digest",checked:t.email_mode==="daily_digest",onChange:s=>W({email_mode:s.target.value}),className:"mt-1 w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Daily Digest (Recommended)"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Send one summary email per day at ",t.digest_send_time]})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"email_mode",value:"per_submission",checked:t.email_mode==="per_submission",onChange:s=>W({email_mode:s.target.value}),className:"mt-1 w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Per Submission"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Send an email immediately after each inspection"})]})]}),e.jsxs("label",{className:"flex items-start gap-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors",children:[e.jsx("input",{type:"radio",name:"email_mode",value:"hybrid",checked:t.email_mode==="hybrid",onChange:s=>W({email_mode:s.target.value}),className:"mt-1 w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Hybrid"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Immediate for critical defects, daily digest for routine"})]})]})]})]})}),e.jsx(b,{children:e.jsxs(y,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Recipients"}),e.jsxs("div",{className:"space-y-3",children:[t.recipients.map((s,u)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"email",value:s,onChange:S=>{const H=[...t.recipients];H[u]=S.target.value,M({...t,recipients:H})},className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"email@example.com"}),e.jsx(v,{onClick:()=>{const S=t.recipients.filter((H,le)=>le!==u);W({recipients:S})},variant:"secondary",className:"bg-red-50 hover:bg-red-100 text-red-700",children:"Remove"})]},u)),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(v,{onClick:()=>{const s=[...t.recipients,""];M({...t,recipients:s})},variant:"secondary",children:"+ Add Recipient"}),e.jsx(v,{onClick:()=>W({recipients:t.recipients.filter(s=>s!=="")}),disabled:ee,children:"Save Recipients"})]})]})]})}),e.jsx(b,{children:e.jsx(y,{className:"p-6",children:e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.enable_immediate_for_critical,onChange:s=>W({enable_immediate_for_critical:s.target.checked}),className:"mt-1 w-5 h-5 text-blue-600 rounded"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Immediate Alerts for Critical Defects"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Send immediate email when critical defects are found (only in hybrid mode)"})]})]})})}),e.jsx(b,{children:e.jsxs(y,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Daily Email Limit"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"number",value:t.daily_email_hard_cap,onChange:s=>M({...t,daily_email_hard_cap:parseInt(s.target.value)||250}),className:"w-32 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",min:"1",max:"500"}),e.jsx("span",{className:"text-gray-600",children:"emails per day (max: 500)"}),e.jsx(v,{onClick:()=>W({daily_email_hard_cap:t.daily_email_hard_cap}),disabled:ee,children:"Save"})]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Current: ",t.daily_email_hard_cap," / Recommended: 250"]})]})}),e.jsx(b,{children:e.jsxs(y,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Email Subject Template"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",value:t.email_subject_template,onChange:s=>M({...t,email_subject_template:s.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"MBFD Daily Inspection Summary - {date}"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Use ","{date}"," for the current date"]}),e.jsx(v,{onClick:()=>W({email_subject_template:t.email_subject_template}),disabled:ee,children:"Save Template"})]})]})})]}):e.jsx(b,{children:e.jsxs(y,{className:"py-12 text-center",children:[e.jsx(Ie,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Click the button below to load email configuration"}),e.jsx(v,{onClick:De,children:"Load Configuration"})]})})]})]})]})},X=({icon:x,label:m,badge:c,badgeColor:h="red",isActive:g,onClick:k})=>{const n=m==="Home"?"Home":m==="Inspection Issues"?"Issues":m==="Daily Activity"?"Activity":m==="Supply Alerts"?"Supplies":m==="Apparatus Status"?"Apparatus":m==="AI Insights"?"AI":m;return e.jsxs("button",{onClick:k,className:`
        flex items-center gap-2 px-3 sm:px-4 lg:px-6 py-2 sm:py-3 font-semibold
        transition-all whitespace-nowrap relative flex-shrink-0 text-sm sm:text-base
        ${g?"text-white border-b-2 border-white bg-white/10":"text-blue-200 hover:text-white hover:bg-white/5"}
      `,children:[e.jsx(x,{className:"w-4 h-4 sm:w-5 sm:h-5 flex-shrink-0"}),e.jsx("span",{className:"hidden sm:inline",children:m}),e.jsx("span",{className:"sm:hidden",children:n}),c!==void 0&&c>0&&e.jsx("span",{className:`
          ${h==="red"?"bg-red-500":"bg-yellow-500"}
          text-white text-xs px-2 py-0.5 rounded-full font-bold min-w-[20px] text-center
        `,children:c})]})};export{tt as AdminDashboard};
//# sourceMappingURL=AdminDashboard-BekpfgE6.js.map
