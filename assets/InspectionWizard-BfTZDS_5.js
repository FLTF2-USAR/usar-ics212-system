import{r as d,j as e,u as de}from"./index-BW-9n5qP.js";import{c as $,b as O,B as C,C as he,d as ue,a as me}from"./config-WiYK23FM.js";import{X as B,T as Q,M as G,g as J,C as xe,a as K}from"./github-BfOOMduu.js";const ge=[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]],pe=$("check-check",ge);const fe=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],be=$("check",fe);const ye=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],je=$("chevron-left",ye);const we=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Ne=$("chevron-right",we);const ve=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],ke=$("gauge",ve);const Ce=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Se=$("shield",Ce),Ie=({item:r,status:o,hasExistingDefect:n,onStatusChange:c})=>{const[u,f]=d.useState(!1),[a,m]=d.useState("missing"),[i,x]=d.useState(""),S=typeof r=="string"?r:r.name,E=typeof r=="object"?r.expectedQuantity:void 0,j=typeof r=="object"?r.note:void 0,w=N=>{N==="present"?(c("present"),x("")):(m(N),f(!0))},H=()=>{if(!i.trim()){alert("Please enter notes describing the issue");return}c(a,i),f(!1),x("")},D=()=>{f(!1),x("")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:O("flex items-center justify-between p-4 rounded-2xl transition-all duration-200 border-2 shadow-sm",{"bg-white border-gray-200 hover:border-gray-300":o==="present"&&!n,"bg-green-50 border-green-500 shadow-green-100":o==="present"&&!n,"bg-red-50 border-red-500 shadow-red-100":o==="missing","bg-yellow-50 border-yellow-500 shadow-yellow-100":o==="damaged","bg-orange-50 border-orange-500 shadow-orange-100":n}),children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-3",children:[e.jsxs("p",{className:"font-semibold text-gray-900 text-base leading-tight",children:[S,E&&e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",E,")"]})]}),j&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:j}),n&&e.jsx("span",{className:"inline-block mt-2 px-3 py-1 bg-orange-600 text-white text-xs font-bold rounded-full shadow-sm",children:"âš ï¸ Previously Reported"})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>w("present"),className:O("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",o==="present"?"bg-green-500 text-white shadow-lg scale-105 shadow-green-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Present/Working",children:e.jsx(be,{className:"w-7 h-7 stroke-[3]"})}),e.jsx("button",{onClick:()=>w("missing"),className:O("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",o==="missing"?"bg-red-500 text-white shadow-lg scale-105 shadow-red-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Missing",children:e.jsx(B,{className:"w-7 h-7 stroke-[3]"})}),e.jsx("button",{onClick:()=>w("damaged"),className:O("flex items-center justify-center w-14 h-14 rounded-2xl transition-all duration-200 active:scale-95",o==="damaged"?"bg-yellow-500 text-white shadow-lg scale-105 shadow-yellow-200":"bg-gray-100 text-gray-400 hover:bg-gray-200 active:bg-gray-300"),title:"Damaged",children:e.jsx(Q,{className:"w-7 h-7 stroke-[3]"})})]})]}),e.jsx(G,{isOpen:u,onClose:D,title:`Item ${a==="missing"?"Missing":"Damaged"}: "${S}"`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-xl bg-gradient-to-r from-gray-50 to-gray-100",children:[a==="missing"?e.jsx("div",{className:"w-12 h-12 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0",children:e.jsx(B,{className:"w-6 h-6 text-red-600"})}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center flex-shrink-0",children:e.jsx(Q,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-600",children:a==="missing"?"Missing Equipment":"Damaged Equipment"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Please provide detailed information"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{value:i,onChange:N=>x(N.target.value),placeholder:"Describe the issue in detail...",rows:4,className:"w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-4 focus:ring-blue-400 focus:border-blue-500 outline-none transition-all resize-none text-base",autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Provide as much detail as possible to help with resolution"})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-blue-800",children:["ðŸ“¸ ",e.jsx("strong",{children:"Photo upload coming soon!"})," For now, please include detailed descriptions in your notes."]})}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(C,{onClick:H,className:"flex-1 h-12 text-base font-bold rounded-xl",children:"Submit Report"}),e.jsx(C,{onClick:D,variant:"secondary",className:"flex-1 h-12 text-base font-bold rounded-xl",children:"Cancel"})]})]})})]})},$e=()=>{const[r,o]=d.useState(()=>{const n=window.innerWidth,c=window.innerHeight;return{isMobile:n<768,isTablet:n>=768&&n<1024,isDesktop:n>=1024,screenWidth:n,screenHeight:c,orientation:n>c?"landscape":"portrait"}});return d.useEffect(()=>{const n=()=>{const c=window.innerWidth,u=window.innerHeight;o({isMobile:c<768,isTablet:c>=768&&c<1024,isDesktop:c>=1024,screenWidth:c,screenHeight:u,orientation:c>u?"landscape":"portrait"})};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),r};function X(r,o){const n=()=>{if(typeof window>"u")return o;try{const a=window.localStorage.getItem(r);return a?JSON.parse(a):o}catch(a){return console.warn(`Error reading localStorage key "${r}":`,a),o}},[c,u]=d.useState(n),f=a=>{try{const m=a instanceof Function?a(c):a;u(m),typeof window<"u"&&window.localStorage.setItem(r,JSON.stringify(m))}catch(m){console.warn(`Error setting localStorage key "${r}":`,m)}};return d.useEffect(()=>{u(n())},[]),[c,f]}function De(r,o=10){const[n,c]=X(`field_history_${r}`,[]);return{history:n,addToHistory:a=>{!a||!a.trim()||c(m=>{const i=m.filter(S=>S!==a);return[a,...i].slice(0,o)})},clearHistory:()=>{c([])}}}const Oe=()=>{const r=de(),o=$e(),[n,c]=d.useState(null),[u,f]=d.useState(null),[a,m]=d.useState(0),[i,x]=d.useState(new Map),[S,E]=d.useState(new Map),[j,w]=d.useState([]),[H,D]=d.useState(!0),[N,L]=d.useState(!1),[Y,q]=d.useState(!1),[z,Z]=d.useState(0),[A,ee]=X("mbfd_last_officer_values",{});d.useEffect(()=>{const s=sessionStorage.getItem("user");if(!s){r("/");return}const t=JSON.parse(s);c(t),se(t)},[r]);const se=async s=>{try{const h=s.apparatus.startsWith("Engine")?"engine_checklist.json":"rescue_checklist.json",l=await(await fetch(`/mbfd-checkout-system/data/${h}`)).json();f(l);const g=new Map;l.compartments.forEach(k=>{k.items.forEach(y=>{const _=typeof y=="string"?y:y.name,le=`${k.id}:${_}`;g.set(le,{name:_,status:"present",inputType:typeof y=="object"?y.inputType:"checkbox",expectedQuantity:typeof y=="object"?y.expectedQuantity:void 0})})}),x(g),l.officerChecklist&&w(l.officerChecklist.map(k=>({...k,checked:!1,value:A[k.id]||""})));const I=await J.checkExistingDefects(s.apparatus);E(I),D(!1)}catch(t){console.error("Error loading data:",t),alert("Error loading inspection data. Please try again."),D(!1)}},te=(s,t,h,p)=>{x(l=>{const g=new Map(l),I=g.get(s);return I&&g.set(s,{...I,status:t,notes:h,photoUrl:p}),g})},re=(s,t,h)=>{w(p=>{const l=[...p];l[s]={...l[s],checked:t,value:h};const g={...A};return g[l[s].id]=h||"",ee(g),l})},ne=()=>{w(s=>s.map(t=>({...t,checked:!0,value:t.value||(t.required&&t.inputType!=="checkbox"?"N/A":t.value)})))},ae=()=>{b&&x(s=>{const t=new Map(s);return b.items.forEach(h=>{const p=typeof h=="string"?h:h.name,l=`${b.id}:${p}`,g=t.get(l);g&&t.set(l,{...g,status:"present"})}),t})},oe=async()=>{if(!(!n||!u)){L(!0);try{const s=[];i.forEach(t=>{if(t.status!=="present"){const h=u.compartments.find(p=>p.items.some(l=>(typeof l=="string"?l:l.name)===t.name));s.push({compartment:h?.title||"Unknown",item:t.name,status:t.status,notes:t.notes||"",photoUrl:t.photoUrl})}}),await J.submitChecklist({user:n,apparatus:n.apparatus,date:new Date().toISOString(),items:Array.from(i.values()),defects:s,shift:n.shift,unitNumber:n.unitNumber,officerChecklist:j}),sessionStorage.removeItem("user"),Z(s.length),q(!0)}catch(s){console.error("Error submitting inspection:",s);let t="Error submitting inspection. Please try again.";s instanceof Error&&(s.message.includes("Failed to fetch")?t="No internet connection. Please check your connection and try again.":s.message.includes("defect submissions failed")&&(t="Some defects failed to submit. Please check your connection and try again. Partial data may have been recorded.")),alert(t)}finally{L(!1)}}},R=()=>{q(!1),r("/")};if(H)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-gray-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-600 border-t-transparent mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-semibold",children:"Loading inspection checklist..."})]})});if(!n||!u)return null;const P=j.length>0,F=(P?1:0)+u.compartments.length,v=P&&a===0,ce=P?a-1:a,b=v?null:u.compartments[ce],ie=a===F-1,U=v?j.every(s=>s.inputType==="checkbox"?s.checked:s.required?s.checked&&s.value&&s.value.toString().trim()!=="":s.checked||s.value&&s.value.toString().trim()!==""):b?.items.every(s=>{const t=typeof s=="string"?s:s.name,h=`${b.id}:${t}`;return i.get(h)?.status!==void 0}),W=new Date().toLocaleDateString("en-US",{weekday:"long"}),M=u.dailySchedule?.find(s=>s.day===W),T=o.isDesktop?"max-w-7xl mx-auto":o.isTablet?"max-w-4xl px-4":"max-w-2xl px-4",V=o.isDesktop?"grid grid-cols-2 lg:grid-cols-3 gap-4":"space-y-3";return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-gray-100 pb-24",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-800 via-blue-900 to-blue-800 text-white sticky top-0 z-10 shadow-2xl",children:e.jsxs("div",{className:`${T} mx-auto ${o.isDesktop?"px-6":"px-4"} py-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:n.apparatus}),e.jsxs("p",{className:"text-sm text-blue-100",children:[n.name," â€¢ ",n.rank]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xs text-blue-200",children:["Shift ",n.shift]}),e.jsxs("p",{className:"text-sm font-semibold",children:["Unit ",n.unitNumber]}),o.isDesktop&&e.jsx("p",{className:"text-xs text-blue-300 mt-1",children:"ðŸ–¥ï¸ Desktop Mode"})]})]}),e.jsx("div",{className:"flex items-center gap-1.5",children:Array.from({length:F}).map((s,t)=>e.jsx("div",{className:`h-2 flex-1 rounded-full transition-all duration-300 ${t<a?"bg-green-400":t===a?"bg-white":"bg-blue-600"}`},t))}),e.jsxs("p",{className:"text-xs text-blue-100 mt-2 text-center font-medium",children:["Step ",a+1," of ",F]})]})}),M&&M.tasks.length>0&&M.tasks[0]!=="None"&&e.jsx("div",{className:`${T} mx-auto ${o.isDesktop?"px-6":"px-4"} mt-4`,children:e.jsx("div",{className:"bg-gradient-to-r from-amber-50 to-yellow-50 border-2 border-amber-400 rounded-2xl p-4 shadow-md",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(xe,{className:"w-6 h-6 text-amber-700 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-bold text-amber-900 mb-1",children:["Today's Schedule - ",W]}),e.jsx("ul",{className:"space-y-1",children:M.tasks.map((s,t)=>e.jsxs("li",{className:"text-sm text-amber-800 font-medium",children:["â€¢ ",s]},t))})]})]})})}),e.jsx("div",{className:`${T} mx-auto ${o.isDesktop?"px-6":"px-4"} py-6`,children:e.jsxs(he,{className:`shadow-2xl ${o.isDesktop?"rounded-xl":"rounded-2xl"}`,children:[e.jsx(ue,{className:"bg-gradient-to-r from-gray-50 to-slate-50 border-b-2 border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[v?e.jsx(Se,{className:"w-8 h-8 text-blue-700"}):e.jsx(ke,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:v?"Officer Checklist":b?.title}),e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:v?"Complete all officer-specific checks":"Check all equipment in this compartment"})]})]}),e.jsxs(C,{onClick:v?ne:ae,variant:"secondary",className:"flex items-center gap-2 h-10 px-4 text-sm font-bold bg-blue-100 hover:bg-blue-200 text-blue-800",children:[e.jsx(pe,{className:"w-5 h-5"}),o.isMobile?"All OK":"Check All"]})]})}),e.jsx(me,{className:o.isDesktop?"p-6":"p-4",children:v?e.jsx("div",{className:V,children:j.map((s,t)=>e.jsx(Ee,{item:s,index:t,onChange:re},s.id))}):e.jsx("div",{className:V,children:b?.items.map(s=>{const t=typeof s=="string"?s:s.name,h=`${b.id}:${t}`,p=i.get(h),l=`${b.title}:${t}`,g=S.has(l),I=typeof s=="object"?s:{name:s,inputType:"checkbox"};return e.jsx(Ie,{item:I,compartmentId:b.id,status:p?.status||"present",hasExistingDefect:g,onStatusChange:(k,y,_)=>te(h,k,y,_)},h)})})})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-300 p-4 shadow-2xl",children:e.jsxs("div",{className:`${T} mx-auto ${o.isDesktop?"px-6":""} flex gap-3`,children:[a>0&&e.jsxs(C,{onClick:()=>m(a-1),variant:"secondary",className:"flex items-center gap-2 h-14 px-6 rounded-xl font-bold bg-gray-100 hover:bg-gray-200 text-gray-800",children:[e.jsx(je,{className:"w-5 h-5"}),"Previous"]}),e.jsx("div",{className:"flex-1"}),ie?e.jsx(C,{onClick:oe,disabled:!U||N,className:"flex items-center gap-2 h-14 px-8 rounded-xl font-bold shadow-lg bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 disabled:from-gray-400 disabled:to-gray-500",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-6 h-6"}),"Complete Inspection"]})}):e.jsxs(C,{onClick:()=>m(a+1),disabled:!U,className:"flex items-center gap-2 h-14 px-8 rounded-xl font-bold shadow-lg bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900 disabled:from-gray-400 disabled:to-gray-500",children:["Next",e.jsx(Ne,{className:"w-5 h-5"})]})]})}),e.jsx(G,{isOpen:Y,onClose:R,title:"Inspection Complete!",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(K,{className:"w-12 h-12 text-green-600"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"âœ… Inspection Submitted Successfully!"}),e.jsxs("p",{className:"text-gray-700 font-medium",children:["Your ",n?.apparatus," inspection has been recorded."]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 border-2 border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-800 font-semibold",children:[e.jsx("strong",{children:"Defects Reported:"})," ",z]}),z>0&&e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Issues have been logged and will be reviewed by maintenance."})]}),e.jsx(C,{onClick:R,className:"w-full h-12 text-base font-bold rounded-xl bg-gradient-to-r from-blue-700 to-blue-800 hover:from-blue-800 hover:to-blue-900",children:"Return to Home"})]})})]})},Ee=({item:r,index:o,onChange:n})=>{const{history:c,addToHistory:u}=De(r.id),[f,a]=d.useState(!1),m=(i,x)=>{n(o,i,x),x&&typeof x=="string"&&u(x)};return r.inputType==="checkbox"?e.jsxs("div",{className:"flex items-center gap-3 p-4 rounded-xl bg-white border-2 border-gray-300 transition-all hover:border-blue-400 shadow-sm",children:[e.jsx("input",{type:"checkbox",checked:r.checked,onChange:i=>m(i.target.checked),className:"w-6 h-6 rounded-lg border-2 border-gray-400 text-blue-600 focus:ring-4 focus:ring-blue-400 cursor-pointer"}),e.jsx("label",{className:"flex-1 font-semibold text-gray-900 cursor-pointer",children:r.name})]}):e.jsxs("div",{className:"p-4 rounded-xl bg-white border-2 border-gray-300 space-y-2 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:r.checked,onChange:()=>m(!r.checked,r.value),className:"w-5 h-5 rounded border-2 border-gray-400 text-blue-600 cursor-pointer"}),e.jsxs("label",{className:"font-semibold text-gray-900 text-sm",children:[r.name,r.required&&e.jsx("span",{className:"text-red-600 ml-1",children:"*"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:r.inputType==="number"||r.inputType==="percentage"?"number":"text",value:r.value||"",onChange:i=>m(r.checked,r.inputType==="number"?parseFloat(i.target.value)||"":i.target.value),onFocus:()=>a(!0),onBlur:()=>setTimeout(()=>a(!1),200),placeholder:r.inputType==="percentage"?"Enter %":r.inputType==="number"?"Enter number":"Enter value",className:"w-full px-3 py-3 text-base rounded-lg border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-600 outline-none bg-white text-gray-900 font-medium"}),f&&c.length>0&&r.inputType==="text"&&e.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white border-2 border-gray-300 rounded-lg shadow-xl max-h-40 overflow-y-auto",children:c.map((i,x)=>e.jsx("button",{onClick:()=>{m(!0,i),a(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-blue-50 transition-colors text-gray-900 font-medium",children:i},x))})]})]})};export{Oe as InspectionWizard};
//# sourceMappingURL=InspectionWizard-BfTZDS_5.js.map
